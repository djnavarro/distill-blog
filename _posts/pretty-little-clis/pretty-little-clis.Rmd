---
title: "Pretty little CLIs"
description: |
  How to make a gorgeous command line interface in R using the cli package.
author:
  - name: Danielle Navarro
    url: https://djnavarro.net
date: 04-16-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "hold")

# enable ANSI to HTML using the fansi package: ensures that the
# ANSI terminal colours are translated into HTML correctly
options(crayon.enabled = TRUE)
knitr::knit_hooks$set(output = function(x, options){
  paste0(
    "<pre class=\"r-output\"><code>",
    fansi::sgr_to_html(x = x, warn = FALSE, term.cap = "256"),
    "</code></pre>"
  )
})
```


If you've been working in R for any length of time, you've probably realised that you sometimes need to write code that prints information to the R console, and if you're like me you've learned that the simplest way to do this is to use the `cat()` function. Perhaps you find yourself writing code like this:

```{r define-godot-1, echo=FALSE}
wait_for_godot <- function() {
  return(invisible(NULL))
}
```

```{r example-with-cat, eval=FALSE}
cat("Waiting for Godot")
wait_for_godot()
cat("...done!\n")
```
In a realistic example, the `wait_for_godot()` function would likely be something that takes some time to complete, and the lines above and below are a polite way to let your user (even if that's just you!) know when the Godot process starts and when it finishes. For simplicity, suppose `wait_for_godot()` is a function that takes one second to evaluate, such as this one:

```{r define-godot-2, eval=FALSE}
wait_for_godot <- function() {
  Sys.sleep(1)
}
```

If you execute the code above by sourcing a script, the first thing you see at the console is the initial message:

```{r message-only, echo=FALSE}
cat("Waiting for Godot")
```

and then after a one second delay, this message is updated to show both messages:

```{r, ref.label="example-with-cat", echo=FALSE, eval=TRUE}
```

This approach works perfectly well for simple communication, but sometimes you want something that looks a little nicer. For example, if you've worked with tidyverse for any length of time you will have noticed that messages produced by tidyverse packages seem to have a more polished look to them. Perhaps, like me, you've wondered how the magic works and if you too can create pretty messages at the console. As it happens, many wonderful things become possible if you happen to have the [cli](https://cli.r-lib.org) package as your talented assistant, and in this post I'll talk about some of them.


## Meet the cli package

The cli package is developed by [Gábor Csárdi](https://twitter.com/GaborCsardi), and its goal is to help you effortlessly create a beautiful command line interface (CLI) of your very own. Load package

```{r package-load, message=FALSE, warning=FALSE}
library(cli)
```

Commands 

```{r alert-messages, eval=FALSE}
cli_h1("Pretty little liars")
cli_alert("Got a secret, can you keep it?")
cli_alert("Swear this one you'll save")
cli_alert("Better lock it, in your pocket")
cli_alert("Taking this one to the grave")
cli_alert("If I show you then I know you, won't tell what I said")
cli_alert("Cause two can keep a secret if one of them is dead")
```


```{r start-app, echo=FALSE}
# create a cli app that directs output to stdout() rather than
# stderr() to ensure that R markdown will show the output
app <- start_app(output = "stdout", .auto_close = TRUE)
```

```{r, ref.label="alert-messages", eval=FALSE, echo=FALSE}
```


```{r display-liars, echo=FALSE}
knitr::include_graphics(
  path = here::here("_posts", "pretty-little-clis", "pretty-little-liars.svg")
)
```



## Spinners

```{r define-spinner, eval=FALSE}
spinner <- make_spinner(
  which = "dots2", 
  template = "{spin} Waiting for Godot"
)

wait_for_godot <- function(spinner) {
  for(i in 1:100) {
    spinner$spin()
    Sys.sleep(.05)
  }
  spinner$finish()
}

wait_for_godot(spinner)
cli_alert_success("Waiting for Godot ... done!")
```

```{r display-spinner, echo=FALSE}
# spinner-godot SVG file is generated using asciicast
knitr::include_graphics(
  path = here::here("_posts", "pretty-little-clis", "spinner-godot.svg")
)
```


```{r stop-cli-app, echo=FALSE}
stop_app(app) # stop the cli app
```


