---
title: "Title in sentence case" # <---- UPDATE ME
description:
  Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, 
  consectetur, adipisci velit # <---- UPDATE ME
author:
  - first_name: "Danielle"
    last_name: "Navarro"
    url: https://djnavarro.net
    affiliation: UNSW Sydney
    affiliation_url: https://unsw.edu.au
    orcid_id: 0000-0001-7648-6578
preview: preview-image.jpg  # <---- UPDATE ME 
creative_commons: CC BY
output:
  distill::distill_article:
    self_contained: false
params:
  slug: tidy-tuesday-billboard
  date: 2021-09-14
  repo: djnavarro/distill-blog
  site: https://blog.djnavarro.net/
  data_billboard: https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-14/billboard.csv
  data_audio_features: https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-09-14/audio_features.csv
  data_readme: https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-09-14/readme.md
---

<!----

checklist:
  - check the "update me" messages in YAML above
  - initialise the _renv folder with refinery::renv_new(long_slug)
  - populate the lockfile with refinery::renv_snapshot(long_slug)
  - update the _renv folder from snapshot with refinery::refresh(long_slug)

---->


<!--------------- setup post ----------------->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
refinery::renv_load(paste(params$date, params$slug, sep = "_"))
```

<!--------------- post ----------------->

I've never participated in [Tidy Tuesday](https://github.com/rfordatascience/tidytuesday) before, but since I've joined a slack that does, it is high time I did something about that poor track record. The data are located on the Tidy Tuesday repository. I've stored the link to the data in the YAML header for this post 

```{r show-yaml-params, results='hold'}
params$data_billboard
params$data_audio_features
```

Packages I'm going to use a lot get attached:

```{r attach-packages, message=FALSE}
library(dplyr)
library(stringr)
```

## Import the data

So I can read the data with the following code^[I also set `cache=TRUE` in the chunk options to avoid downloading the data each time I knit the post, and added the cached folder to the `.gitignore` file to avoid placing cached data under version control]


```{r import-billboard-data, cache=TRUE}
billboard <- readr::read_csv(params$data_billboard)
billboard
```

Repeat for the audio features data:

```{r import-audio-features-data, cache=TRUE}
audio_features <- readr::read_csv(params$data_audio_features) 
audio_features
```

## Assembling the Britney data

Make a decision: today I have love only for Britney. First up, let's take a quick look at the `performer` variable, because I suspect she's going to appear in a few different forms:

```{r look-for-britney-1}
billboard %>% 
  pull(performer) %>% 
  str_subset("(Britney)|(Spears)") %>% 
  table() %>% 
  sort(decreasing = TRUE)
```

Another decision: I'm happy to include her collaborations with other artists, but I only want cases where she is the primary artist. So the regular expression I'm going to use to select Britney songs is `"^Britney Spears"`. That matches the following:

```{r look-for-britney-2}
billboard %>% 
  pull(performer) %>% 
  str_subset("^Britney Spears") %>% 
  unique()
```

As a little sanity check, I want to make sure that I obtain the same for the `audio_features` data:

```{r look-for-britney-3}
audio_features %>% 
  pull(performer) %>% 
  str_subset("^Britney Spears") %>% 
  unique()
```

It retains Britney songs featuring other artists but not songs by other artists featuring Britney. In my ideal world I'd subset and join the two data sets in one fell swoop but as yet I haven't made anything except the most cursory checks that I know how to join them sensibly. So, one step at a time, sweetie. Filter first: 

```{r filter-to-britney}
britney_billboard <- billboard %>% 
  filter(str_detect(performer, "^Britney Spears"))

britney_features <- audio_features %>% 
  filter(str_detect(performer, "^Britney Spears"))
```
  
A quick `glimpse()` at both:

```{r glimpse-britney-partials}
glimpse(britney_billboard)
glimpse(britney_features)
```

Are the `song_id` values in the two data frames comparable? I suspect that they will be because (I'm told that) Tidy Tuesday does a good job of pre-cleaning the data, but in my old age I have become paranoid. So let's just make sure it's a suitable basis for a join

```{r check-join-key}
intersect(
  britney_billboard$song_id, 
  britney_features$song_id
)
setdiff(
  britney_billboard$song_id, 
  britney_features$song_id
)
setdiff(
  britney_features$song_id, 
  britney_billboard$song_id
)
```

Everything I ever dreamed of! Okay that's going to make my life so much easier:

```{r join-and-glimpse}
britney <- britney_billboard %>% 
  left_join(britney_features)

glimpse(britney)
```

<!--------------- appendices ----------------->

```{r, echo=FALSE}
refinery::insert_appendix(
  repo_spec = params$repo, 
  dir = paste(params$date, params$slug, sep = "_")
)
```


<!--------------- miscellanea ----------------->

```{r redirect, echo=FALSE}
refinery::insert_netlify_redirect(
  slug = params$slug, 
  date = params$date
)
```


<!--------------- derived YAML ----------------->
---
date: `r params$date`
citation_url: `r paste0(params$site, params$slug)`
repository_url: `r paste0("https://github.com/", params$repo)` 
---



